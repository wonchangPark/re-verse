/*
Auto-generated by: https://github.com/pmndrs/gltfjsx
author: L3X (https://sketchfab.com/L3X)
license: SKETCHFAB Editorial (https://sketchfab.com/licenses)
source: https://sketchfab.com/3d-models/retro-polaroid-93862442911e4fe598d2b8bf04cee421
title: Retro Polaroid
*/

import React, { useRef } from "react";
import { useGLTF } from "@react-three/drei";
import { useFrame } from "@react-three/fiber";
import { gsap } from "gsap";

export function Polaroid({ props, position, event }) {
  const { nodes, materials } = useGLTF("/assets/retro_polaroid/scene.gltf");

  const memoryObject = useRef();
  const memorySpot = useRef();
  console.log("======================[polaroid]======================");
  console.log(event);
  useFrame((state) => {
    if (event === 1) {
      memorySpot.current.children[0].material.color.r = 1;
      memorySpot.current.children[0].material.color.b = 1;

      gsap.to(memoryObject.current.position, {
        duration: 0.3,
        y: 1.1,
        ease: "Bounce.easeOut",
      });
      gsap.to(state.camera.position, {
        duration: 1,
        y: 3,
      });
    } else if (event !== 1) {
      memorySpot.current.children[0].material.color.r = 0;
      memorySpot.current.children[0].material.color.b = 1;
      gsap.to(memoryObject.current.position, {
        duration: 0.4,
        y: -2,
        ease: "Bounce.easeOut",
      });
      gsap.to(state.camera.position, {
        duration: 1,
        y: 5,
      });
    }
  });

  return (
    <group {...props} dispose={null}>
      <group
        ref={memoryObject}
        rotation={[-Math.PI / 2, 0, Math.PI / 6]}
        scale={0.05}
        position={[46, -1, -70]}
        // position={[48.5, 0.8, -70]}
        // position={position}
      >
        <group
          rotation={[Math.PI / 2, 0, 0]}
          onClick={() => {
            console.log("폴라로이드 눌렀다");
          }}
        >
          <group rotation={[-Math.PI / 2, 0, 0]}>
            <mesh
              geometry={nodes.Polaroid_01_Mat_plastic_0.geometry}
              material={materials.Mat_plastic}
              castShadow
              receiveShadow
            />
            <mesh
              geometry={nodes.Polaroid_01_Mat_glass_0.geometry}
              material={materials.Mat_glass}
            />
            <mesh
              geometry={nodes.Polaroid_01_Mat_photo_0.geometry}
              material={materials.Mat_photo}
            />
          </group>
        </group>
      </group>
      {/* 오브젝트 나타나는 지점 */}
      <group ref={memorySpot}>
        <mesh
          rotation={[-0.5 * Math.PI, 0, -0.2 * Math.PI]}
          receiveShadow
          position={[38, 0.01, -68]}
        >
          <planeBufferGeometry attach="geometry" args={[20, 20]} />
          <meshBasicMaterial color="blue" opacity={0.5} transparent />
        </mesh>
      </group>
    </group>
  );
}

useGLTF.preload("/scene.gltf");
